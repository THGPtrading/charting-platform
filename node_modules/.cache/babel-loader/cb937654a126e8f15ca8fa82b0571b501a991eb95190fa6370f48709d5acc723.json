{"ast":null,"code":"// src/utils/series.ts\n\nexport function prepareSeries(setup) {\n  const sorted = [...setup.data].map(d => ({\n    ...d,\n    time: typeof d.time === 'number' ? d.time : Math.floor(new Date(d.time).getTime() / 1000)\n  })).sort((a, b) => a.time - b.time);\n  const deduped = sorted.filter((d, i, arr) => i === 0 || d.time !== arr[i - 1].time);\n  const candles = deduped.map(d => {\n    var _d$open, _d$high, _d$low;\n    return {\n      time: d.time,\n      open: (_d$open = d.open) !== null && _d$open !== void 0 ? _d$open : d.close,\n      high: (_d$high = d.high) !== null && _d$high !== void 0 ? _d$high : d.close,\n      low: (_d$low = d.low) !== null && _d$low !== void 0 ? _d$low : d.close,\n      close: d.close\n    };\n  });\n  const vwap = deduped.filter(d => typeof d.vwap === 'number').map(d => ({\n    time: d.time,\n    value: d.vwap\n  }));\n  return {\n    candles,\n    vwap,\n    raw: deduped\n  };\n}","map":{"version":3,"names":["prepareSeries","setup","sorted","data","map","d","time","Math","floor","Date","getTime","sort","a","b","deduped","filter","i","arr","candles","_d$open","_d$high","_d$low","open","close","high","low","vwap","value","raw"],"sources":["C:/Users/irajc/charting-platform/src/utils/series.ts"],"sourcesContent":["// src/utils/series.ts\r\nimport type { ICCSetup } from '../types/ICC';\r\n\r\nexport function prepareSeries(setup: ICCSetup) {\r\n  const sorted = [...setup.data]\r\n    .map(d => ({ ...d, time: typeof d.time === 'number' ? d.time : Math.floor(new Date(d.time).getTime()/1000) }))\r\n    .sort((a,b) => a.time - b.time);\r\n\r\n  const deduped = sorted.filter((d, i, arr) => i === 0 || d.time !== arr[i-1].time);\r\n\r\n  const candles = deduped.map(d => ({\r\n    time: d.time,\r\n    open: d.open ?? d.close,\r\n    high: d.high ?? d.close,\r\n    low: d.low ?? d.close,\r\n    close: d.close,\r\n  }));\r\n\r\n  const vwap = deduped\r\n    .filter(d => typeof d.vwap === 'number')\r\n    .map(d => ({ time: d.time, value: d.vwap as number }));\r\n\r\n  return { candles, vwap, raw: deduped };\r\n}"],"mappings":"AAAA;;AAGA,OAAO,SAASA,aAAaA,CAACC,KAAe,EAAE;EAC7C,MAAMC,MAAM,GAAG,CAAC,GAAGD,KAAK,CAACE,IAAI,CAAC,CAC3BC,GAAG,CAACC,CAAC,KAAK;IAAE,GAAGA,CAAC;IAAEC,IAAI,EAAE,OAAOD,CAAC,CAACC,IAAI,KAAK,QAAQ,GAAGD,CAAC,CAACC,IAAI,GAAGC,IAAI,CAACC,KAAK,CAAC,IAAIC,IAAI,CAACJ,CAAC,CAACC,IAAI,CAAC,CAACI,OAAO,CAAC,CAAC,GAAC,IAAI;EAAE,CAAC,CAAC,CAAC,CAC7GC,IAAI,CAAC,CAACC,CAAC,EAACC,CAAC,KAAKD,CAAC,CAACN,IAAI,GAAGO,CAAC,CAACP,IAAI,CAAC;EAEjC,MAAMQ,OAAO,GAAGZ,MAAM,CAACa,MAAM,CAAC,CAACV,CAAC,EAAEW,CAAC,EAAEC,GAAG,KAAKD,CAAC,KAAK,CAAC,IAAIX,CAAC,CAACC,IAAI,KAAKW,GAAG,CAACD,CAAC,GAAC,CAAC,CAAC,CAACV,IAAI,CAAC;EAEjF,MAAMY,OAAO,GAAGJ,OAAO,CAACV,GAAG,CAACC,CAAC;IAAA,IAAAc,OAAA,EAAAC,OAAA,EAAAC,MAAA;IAAA,OAAK;MAChCf,IAAI,EAAED,CAAC,CAACC,IAAI;MACZgB,IAAI,GAAAH,OAAA,GAAEd,CAAC,CAACiB,IAAI,cAAAH,OAAA,cAAAA,OAAA,GAAId,CAAC,CAACkB,KAAK;MACvBC,IAAI,GAAAJ,OAAA,GAAEf,CAAC,CAACmB,IAAI,cAAAJ,OAAA,cAAAA,OAAA,GAAIf,CAAC,CAACkB,KAAK;MACvBE,GAAG,GAAAJ,MAAA,GAAEhB,CAAC,CAACoB,GAAG,cAAAJ,MAAA,cAAAA,MAAA,GAAIhB,CAAC,CAACkB,KAAK;MACrBA,KAAK,EAAElB,CAAC,CAACkB;IACX,CAAC;EAAA,CAAC,CAAC;EAEH,MAAMG,IAAI,GAAGZ,OAAO,CACjBC,MAAM,CAACV,CAAC,IAAI,OAAOA,CAAC,CAACqB,IAAI,KAAK,QAAQ,CAAC,CACvCtB,GAAG,CAACC,CAAC,KAAK;IAAEC,IAAI,EAAED,CAAC,CAACC,IAAI;IAAEqB,KAAK,EAAEtB,CAAC,CAACqB;EAAe,CAAC,CAAC,CAAC;EAExD,OAAO;IAAER,OAAO;IAAEQ,IAAI;IAAEE,GAAG,EAAEd;EAAQ,CAAC;AACxC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}